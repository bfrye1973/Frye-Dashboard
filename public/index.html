<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />

    <!-- Base viewport -->
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover"
    />

    <title>Frye Dashboard</title>
    <meta name="theme-color" content="#0d1117" />
    <meta name="color-scheme" content="dark" />
    <!-- marker to confirm weâ€™re editing the real file -->
    <meta name="Frye-Marker" content="public-index-soft-cap-v2" />

    <!-- ========================= BACKEND CONFIG ========================= -->
    <script>
      window.__API_BASE__    = "https://frye-market-backend-1.onrender.com";
      window.__TOS_BASE__    = "https://frye-market-backend-1.onrender.com";
      window.__TOS_WS_BASE__ = "wss://frye-market-backend-1.onrender.com";
      window.__TOS_TOKEN__   = "";

      (function () {
        const tag = "%c[BOOT]";
        const style = "color:#22d3ee;font-weight:700";
        try {
          console.log(tag, style, "Frye Dashboard");
          console.log("%c API_BASE     ", "color:#a3e635", window.__API_BASE__    || "(unset)");
          console.log("%c TOS_BASE     ", "color:#a3e635", window.__TOS_BASE__    || "(unset)");
          console.log("%c TOS_WS_BASE  ", "color:#a3e635", window.__TOS_WS_BASE__ || "(unset)");
          console.log("%c TOS_TOKEN    ", "color:#a3e635", window.__TOS_TOKEN__   ? "(provided)" : "(none)");
        } catch (e) {}
      })();
    </script>

    <!-- ==== ZOOM NORMALIZER & DEBUG ==== -->
    <meta id="vp" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <script>
      (function () {
        var probe = document.createElement('div');
        probe.style.width = '1in';
        probe.style.height = '1in';
        probe.style.position = 'absolute';
        probe.style.left = '-9999px';
        document.documentElement.appendChild(probe);
        var cssPPI = probe.offsetWidth || 96;
        probe.remove();
        var dpr = window.devicePixelRatio || 1;
        window.__SCALE_DEBUG__ = { cssPPI: cssPPI, dpr: dpr };

        if (cssPPI > 130 || cssPPI < 80) {
          var vp = document.getElementById('vp');
          if (vp) vp.setAttribute('content', 'width=device-width, initial-scale=1, maximum-scale=1');
          document.documentElement.classList.add('zoom-reset-tmp');
          setTimeout(function () { document.documentElement.classList.remove('zoom-reset-tmp'); }, 50);
        }
      })();
    </script>
    <!-- ==== END ZOOM NORMALIZER ==== -->

    <!-- ==== ANTI-100VH INLINE SANITIZER (safe to keep) ==== -->
    <script>
      (function() {
        function scrub(el) {
          try {
            var s = el.style; if (!s) return;
            var mh = (s.minHeight || "").replace(/\s/g, "");
            var h  = (s.height    || "").replace(/\s/g, "");
            if (mh === "100vh" || h === "100vh") {
              s.setProperty("min-height", "auto", "important");
              s.setProperty("height", "auto",  "important");
              s.setProperty("max-height", "92vh", "important");
              s.setProperty("overflow", "hidden", "important");
            }
          } catch(_) {}
        }
        document.querySelectorAll("*[style]").forEach(scrub);
        new MutationObserver(function(muts){
          for (var i=0;i<muts.length;i++){
            var m = muts[i];
            if (m.type === "attributes" && m.attributeName === "style") {
              scrub(m.target);
            } else if (m.addedNodes && m.addedNodes.length) {
              m.addedNodes.forEach(function(n){
                if (n && n.nodeType === 1) {
                  if (n.hasAttribute && n.hasAttribute("style")) scrub(n);
                  if (n.querySelectorAll) n.querySelectorAll("*[style]").forEach(scrub);
                }
              });
            }
          }
        }).observe(document.documentElement, {
          subtree: true, childList: true, attributes: true, attributeFilter: ["style"]
        });
      })();
    </script>
    <!-- ==== END ANTI-100VH INLINE SANITIZER ==== -->

    <!-- ===== Ferrari Cluster SOFT CAP (single host, guaranteed) ===== -->
    <style id="cluster-clamp">
      /* Let the panel render naturally; cap growth at 520px */
      [data-cluster-host] {
        min-height: auto !important;
        height: auto !important;
        max-height: 520px !important;
        overflow: hidden !important;
        position: relative;
      }
      [data-cluster-host] svg,
      [data-cluster-host] canvas {
        width: 100% !important;
        height: 100% !important;
        display: block !important;
        overflow: hidden !important;
      }
    </style>
    <script>
      (function () {
        function pickHost() {
          // Prefer explicit cluster panel; otherwise fall back to the largest early container
          var panel = document.querySelector(".cluster .panel, .panel.carbon-fiber");
          if (panel) return panel;

          var cands = Array.from(document.querySelectorAll("div,section,main,article"))
            .map(function(el){ var r = el.getBoundingClientRect(); return { el: el, r: r, a: r.width*r.height }; })
            .filter(function(x){ return x.r.top < 350 && x.r.height > 200 && x.r.width > innerWidth * 0.6; })
            .sort(function(a,b){ return b.a - a.a; });
          return cands[0] && cands[0].el;
        }

        function retag() {
          // Ensure only ONE host is tagged
          document.querySelectorAll("[data-cluster-host]").forEach(function(n){ n.removeAttribute("data-cluster-host"); });
          var host = pickHost();
          if (host) host.setAttribute("data-cluster-host", "");
        }

        function ensureStyle() {
          if (!document.getElementById("cluster-clamp")) {
            var tag = document.createElement("style");
            tag.id = "cluster-clamp";
            tag.textContent =
              "[data-cluster-host]{min-height:auto!important;height:auto!important;max-height:520px!important;overflow:hidden!important;position:relative}" +
              "[data-cluster-host] svg,[data-cluster-host] canvas{width:100%!important;height:100%!important;display:block!important;overflow:hidden!important}";
            document.head.appendChild(tag);
          }
        }

        function init() { ensureStyle(); retag(); }

        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", init);
        } else {
          init();
        }
        new MutationObserver(init).observe(document.documentElement, { subtree: true, childList: true });
      })();
    </script>
    <!-- ===== END SOFT CAP ===== -->

    <style>
      html, body, #root { height: 100%; }
      body {
        margin: 0;
        background: #0d1117;
        color: #d1d4dc;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      svg, text { shape-rendering: geometricPrecision; text-rendering: geometricPrecision; }
      noscript {
        color: #d1d4dc; background: #0d1117; display: block; padding: 12px;
      }
    </style>
  </head>
  <body>
    <noscript>This app requires JavaScript to run.</noscript>
    <div id="root" data-build="Step1-TOS-Link"></div>
    <!-- Your bundler will inject the compiled app script here -->
  </body>
</html>
