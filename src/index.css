/* =========================================================
   Frye Dashboard â€” Ferrari Cluster UI (R8.4)
   Based on your R8.3, with mini gauge readouts below + warn/danger + pulse
   ========================================================= */

:root{
  --bg:#0d1117; --panel:#0e1526; --border:#1f2a44; --text:#d1d4dc; --muted:#9aa4b2;
  --tach-yellow:#ffdd00; --speed-red:#c21a1a; --ring-red:#e21212;
  --ok:#29c651; --warn:#ffc400; --danger:#ff3b3b;
  --off-bg:#1f2633; --off-fg:#566074; --accent-blue:#60a5fa;
}

/* Base */
*{box-sizing:border-box}
html,body,#root{height:100%}
body{margin:0;color:var(--text);background:var(--bg);
  font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji";
  -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
.small{font-size:12px}.muted{opacity:.7}
a{color:var(--accent-blue);text-decoration:none}
a:hover{text-decoration:underline}

/* Panels + carbon shell */
.cluster{display:grid;gap:14px}
.panel{position:relative;background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:12px;overflow:hidden}
.panel::before{content:"";position:absolute;inset:0;pointer-events:none;background:
  linear-gradient(45deg,#101419 25%,transparent 25%) -8px 0/16px 16px,
  linear-gradient(-45deg,#101419 25%,transparent 25%) -8px 0/16px 16px,
  linear-gradient(45deg,transparent 75%,#0b0f14 75%) -8px 0/16px 16px,
  linear-gradient(-45deg,transparent 75%,#0b0f14 75%) -8px 0/16px 16px,
  linear-gradient(0deg,#0a0e15,#0a0e15);opacity:.55}
.panel::after{content:"";position:absolute;inset:0;pointer-events:none;background:
  radial-gradient(1200px 520px at 50% -30%, rgba(255,255,255,.06), transparent 55%),
  radial-gradient(900px 320px at 50% 120%, rgba(0,0,0,.55), transparent 62%)}
.panel-head{display:flex;align-items:center;gap:8px;margin-bottom:10px;z-index:2}
.panel-title{font-weight:700}

/* Build chip */
.build-chip{padding:4px 10px;border-radius:999px;font-weight:800;font-size:12px;background:#3d2e00;color:#ffd15a;border:1px solid #8a6a00;box-shadow:0 0 8px rgba(255,209,90,.35) inset,0 0 8px rgba(255,209,90,.25)}

/* Centered cockpit */
.cockpit-center{ display:block; width:fit-content; max-width:100%; margin-inline:auto; }
.cockpit{ display:grid; align-items:center; column-gap:6px; grid-template-columns:auto auto auto; }
.left-stack{ display:grid; grid-template-columns:1fr 1fr; grid-auto-rows:1fr; gap:12px; margin-right:8px; }
.left-stack .mini{ aspect-ratio:1/1; display:flex; flex-direction:column; align-items:center; justify-content:center; }
.center-tach{ display:flex; justify-content:flex-end; align-items:center; }
.right-speed{ display:flex; justify-content:flex-start; align-items:center; }

/* Big Gauges */
.fg-wrap{display:flex;flex-direction:column;align-items:center}
.fg-title{margin-top:6px;font-weight:800;color:#0b1220}
.gauge-face{width:210px;height:210px;border-radius:50%;border:12px solid #0f172a;position:relative;overflow:hidden;box-shadow:inset 0 0 24px #000,0 0 18px #000;isolation:isolate}
.gauge--tach .gauge-face{background:var(--tach-yellow)}
.gauge--speed .gauge-face{background:var(--speed-red)}

/* Red ring (default) */
.ring{position:absolute;inset:10px;border-radius:50%;box-shadow:inset 0 0 0 18px var(--ring-red), inset 0 0 52px rgba(226,18,18,.35);z-index:2}

/* Numerals */
.dial-numerals{position:absolute;inset:0;z-index:4}
.numeral{fill:#fff;font-weight:800;font-size:16px;text-shadow:0 1px 0 rgba(0,0,0,.55)}
.numeral.speed{font-size:14px}

/* Tach redline */
.redline-arc{position:absolute;inset:10px;border-radius:50%;box-shadow: inset 0 0 0 18px rgba(226,18,18,.36);clip-path: polygon(50% 50%, 100% 10%, 100% 90%);z-index:1;pointer-events:none}

/* Needle / hub / glass */
.needle{position:absolute;left:50%;top:50%;width:90px;height:3px;background:#fff;transform-origin:0% 50%;box-shadow:0 0 4px #000;z-index:5}
.hub{position:absolute;left:50%;top:50%;width:20px;height:20px;border-radius:50%;transform:translate(-50%,-50%);background:#111;border:3px solid #888;z-index:5}
.glass{position:absolute;inset:0;border-radius:50%;background:radial-gradient(55% 35% at 50% 15%, rgba(255,255,255,.22), rgba(255,255,255,.08) 42%, transparent 62%),linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,.42) 62%);mix-blend-mode:screen;pointer-events:none;z-index:6}

/* Branding arcs */
.logo-ring{
  position:absolute;
  left:50%; top:50%;
  transform:translate(-50%,-50%);
  width:260px; height:260px;
  pointer-events:none;
  z-index:7;
}
.logo-top, .logo-bottom{
  fill:#f7f7f7; font-weight:800; letter-spacing:2.2px;
  text-shadow:0 1px 0 rgba(0,0,0,.6), 0 0 8px rgba(255,255,255,.12);
  font-size:12px;
}

/* Engine Lights Row */
.lights{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;align-items:center}
.light{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid #2b3550;background:var(--off-bg);color:var(--off-fg);font-size:12px;font-weight:800;transition:box-shadow .2s ease, background .2s ease, color .2s ease}
.light-icon{font-size:14px;opacity:.85}
.light.ok{background:linear-gradient(180deg,#67f28f,#29c651);color:#05280e;border-color:#1a7c3a;box-shadow:0 0 12px rgba(41,198,81,.55), 0 0 0 1px rgba(41,198,81,.4) inset}
.light.warn{background:linear-gradient(180deg,#ffe47a,#ffc400);color:#3a2a00;border-color:#a07b00;box-shadow:0 0 12px rgba(255,196,0,.55), 0 0 0 1px rgba(255,196,0,.4) inset}
.light.danger{background:linear-gradient(180deg,#ff9a9a,#ff3b3b);color:#2e0000;border-color:#a31212;box-shadow:0 0 12px rgba(255,59,59,.6), 0 0 0 1px rgba(255,59,59,.45) inset}

/* Minis (clean dial + readout below + rim colors + pulse on danger) */
.mini{display:flex;flex-direction:column;align-items:center}
.mini-face{
  width:110px;height:110px;border-radius:50%;
  background: radial-gradient(circle at 30% 30%, #1a1a1a, #000);
  border:4px solid #555; display:flex;align-items:center;justify-content:center;
  box-shadow: inset 0 0 12px #000, 0 0 8px #111; position:relative;
}
.mini-needle{position:absolute;left:50%;top:50%;width:42px;height:2px;background:#e74a4a;transform-origin:0% 50%;transform:rotate(-90deg)}
.mini-hub{position:absolute;left:50%;top:50%;width:12px;height:12px;border-radius:50%;transform:translate(-50%,-50%);background:#111;border:2px solid #777}

/* readout below dial */
.readout{ margin-top:4px; font-size:14px; font-weight:800; letter-spacing:.3px; }
.readout.ok{ color:#22c55e; }
.readout.warn{ color:#f59e0b; }
.readout.danger{ color:#ef4444; }
.mini-title{ font-size:12px; opacity:.8; margin-top:2px; letter-spacing:.4px; }

/* Rim colors by state */
.gauge.ok{   border-color:#22c55e; box-shadow:0 0 6px #22c55e88, inset 0 0 6px #22c55e33; }
.gauge.warn{ border-color:#f59e0b; box-shadow:0 0 6px #f59e0b88, inset 0 0 6px #f59e0b33; }
.gauge.danger{
  border-color:#ef4444;
  animation: rim-pulse 1.4s ease-in-out infinite;
}

/* Pulse for danger rim */
@keyframes rim-pulse{
  0%   { box-shadow:0 0 4px #ef444466, inset 0 0 6px #ef444433; }
  50%  { box-shadow:0 0 12px #ef4444aa, inset 0 0 10px #ef444466; }
  100% { box-shadow:0 0 4px #ef444466, inset 0 0 6px #ef444433; }
}

/* Odometers & Sectors */
.odos{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px}
.odo{background:#0b1220;border:1px solid var(--border);border-radius:10px;padding:10px;text-align:center}
.odo-label{font-size:12px;opacity:.7}
.odo-value{font-size:20px;font-weight:800}

.sectors-grid{display:grid;gap:10px;grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}
.sector-card{border:1px solid var(--border);background:#0b1220;border-radius:10px;padding:10px}
.sector-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.sector-name{font-weight:700}
.spark{display:block}
.spark-line{stroke:#60a5fa}
.sector-spark{color:#60a5fa}

/* ===== R8.3 tweaks kept ===== */

/* 1) Hide ticks on the main odometers (tach + speed) */
.gauge--tach .ticks,
.gauge--speed .ticks { display:none !important; }

/* 2) Mask outer yellow rim around the RPM face (keep red ring) */
.gauge--tach .gauge-face::before{
  content:""; position:absolute; inset:0; border-radius:50%;
  box-shadow: inset 0 0 0 10px #0f172a; z-index:1;
}

/* Sizing & Responsive */
.gauge-face{max-width:700px}
.gauge--tach{transform:scale(1.22)}
.right-speed .gauge--speed{transform:scale(0.90)}

@media (max-width:980px){
  .cockpit{grid-template-columns:1fr}
  .center-tach,.right-speed{justify-content:center}
}

/* Layer order safety */
.ring{z-index:2}.ticks{z-index:3}.dial-numerals{z-index:4}.needle,.hub{z-index:5}.glass{z-index:6}

/* Optional: color big-gauge ring by market state (from data.lights) */
.state-strong .ring{        box-shadow:inset 0 0 0 18px #22c55e, inset 0 0 52px #22c55e44; }
.state-improving .ring{     box-shadow:inset 0 0 0 18px #84cc16, inset 0 0 52px #84cc1644; }
.state-neutral .ring{       box-shadow:inset 0 0 0 18px #64748b, inset 0 0 52px #64748b44; }
.state-deteriorating .ring{ box-shadow:inset 0 0 0 18px #f59e0b, inset 0 0 52px #f59e0b44; }
.state-weak .ring{          box-shadow:inset 0 0 0 18px #ef4444, inset 0 0 52px #ef444444; }
.verdict {
  font-size: 12px; font-weight: 800;
  padding: 4px 10px; border-radius: 999px;
  border: 1px solid #1f2937; background: #0b1220; color: #d1d4dc;
}
.chip-bullish  { border-color:#1a7c3a; background:linear-gradient(180deg,#67f28f,#29c651); color:#05280e; }
.chip-bearish  { border-color:#7f1d1d; background:linear-gradient(180deg,#ff9a9a,#ff3b3b); color:#2e0000; }
.chip-neutral  { border-color:#334155; background:#0b1220; color:#9aa4b2; }
.chip-risk-off { border-color:#a07b00; background:linear-gradient(180deg,#ffe47a,#ffc400); color:#3a2a00; }
.chip-risk-on  { border-color:#1a7c3a; background:linear-gradient(180deg,#67f28f,#29c651); color:#05280e; }
/* Market Summary */
.summary-row {
  display: flex;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
  margin-bottom: 6px;
}
.summary-bullets {
  display: flex;
  gap: 16px;
  flex-wrap: wrap;
}

/* verdict chip colors */
.verdict {
  font-size: 12px;
  font-weight: 800;
  padding: 4px 10px;
  border-radius: 999px;
  border: 1px solid #1f2937;
  background: #0b1220;
  color: #d1d4dc;
}
.chip-bullish   { border-color:#1a7c3a; background:linear-gradient(180deg,#67f28f,#29c651); color:#05280e; }
.chip-bearish   { border-color:#7f1d1d; background:linear-gradient(180deg,#ff9a9a,#ff3b3b); color:#2e0000; }
.chip-neutral   { border-color:#334155; background:#0b1220; color:#9aa4b2; }
.chip-risk-on   { border-color:#1a7c3a; background:linear-gradient(180deg,#67f28f,#29c651); color:#05280e; }
.chip-risk-off  { border-color:#a07b00; background:linear-gradient(180deg,#ffe47a,#ffc400); color:#3a2a00; }

/* strength bar */
.strength {
  flex: 0 0 240px;
  height: 10px;
  border-radius: 6px;
  border: 1px solid #1f2937;
  background: #0b1220;
  overflow: hidden;
}
.strength-bar {
  height: 100%;
  width: 0%;
  transition: width .35s ease;
}
.market-summary {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.summary-row {
  display: flex;
  align-items: center;
  gap: 12px;
}

.chip.verdict {
  padding: 4px 10px;
  border-radius: 999px;
  font-weight: bold;
  font-size: 14px;
}
.chip.verdict.bullish { background:#14532d; color:#22c55e; }
.chip.verdict.neutral { background:#374151; color:#facc15; }
.chip.verdict.bearish { background:#7f1d1d; color:#ef4444; }

.summary-score .bar {
  width: 180px;
  height: 8px;
  background:#1f2937;
  border-radius: 4px;
  overflow:hidden;
}
.summary-score .fill {
  height: 100%;
  background: linear-gradient(90deg,#ef4444,#facc15,#22c55e);
}

.summary-notes {
  display:flex;
  gap:24px;
  font-size:13px;
  opacity:.8;
}
.mini-psi {
  margin-top: 2px;
  font-size: 11px;
  font-weight: 600;
  color: #9aa4b2;
}
/* ==== Chart overlap guard ==== */
.chart-host { position: relative; z-index: 0; overflow: hidden; }

/* Force the lightweight-charts canvases to stay under other sections */
.chart-host .tv-lightweight-charts,
.chart-host .tv-lightweight-charts * {
  z-index: 0 !important;
}

/* Optional: if any section must always float above, add this class to it */
.section-above-chart { position: relative; z-index: 2; }
/* Prevent the lightweight-charts canvases from sitting above other sections */
.chart-host { position: relative; overflow: hidden; isolation: isolate; z-index: 0; }

/* Force all chart canvases to render *behind* surrounding panels */
.chart-host canvas { position: relative; z-index: -1 !important; }

/* Keep the little legend chip visible over the chart only */
.chart-host .chart-legend { position: absolute; z-index: 3; }
/* ==== Chart overlap guard ==== */
.chart-host { position: relative; overflow: hidden; isolation: isolate; z-index: 0; }

/* Put chart canvases under surrounding sections */
.chart-host canvas { position: relative; z-index: -1 !important; }

/* Keep legend above the chart canvas only */
.chart-host .chart-legend { position: absolute; z-index: 3; }
